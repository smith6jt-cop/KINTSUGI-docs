
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Part 3: Isolate signal from autofluorescence and noise. &#8212; KINTSUGI</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'src/notebooks/3_Signal_Isolation';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Part 4: Segment cells and nuclei." href="4_Segmentation.html" />
    <link rel="prev" title="Part 2: Batch Process" href="2_Cycle_Processing.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../Intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/cluster.gif" class="logo__image only-light" alt="KINTSUGI - Home"/>
    <img src="../../_static/cluster.gif" class="logo__image only-dark pst-js-only" alt="KINTSUGI - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../Intro.html">
                    KINTSUGI: Knowledge Integration with New Technologies for Simplified User-Guided Image processing
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../Installation%20Steps.html">Installation Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_Single_Channel_Eval.html">Part 1: Explore data, test and tune processing parameters.</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_Cycle_Processing.html">Part 2: Batch Process</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Part 3: Isolate signal from autofluorescence and noise.</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_Segmentation.html">Part 4: Segment cells and nuclei.</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_Cluster_Pixels.html">Part 5: Cluster pixels.</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_Cluster_Cells.html">Part 6: Cluster cells.</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/smith6jt-cop/KINTSUGI" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/smith6jt-cop/KINTSUGI/issues/new?title=Issue%20on%20page%20%2Fsrc/notebooks/3_Signal_Isolation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/src/notebooks/3_Signal_Isolation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Part 3: Isolate signal from autofluorescence and noise.</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">1. Import packages.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#this-must-be-done-every-time-the-notebook-is-started-or-restarted">*This must be done every time the notebook is started or restarted.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-directory-paths">2. Define directory paths.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">*This must be done every time the notebook is started or restarted.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#this-cell-only-needs-to-be-run-once">2.1 This cell only needs to be run once.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#write-single-channel-tifs">3. Write single channel tifs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-pixel-range-and-weight-of-blank-channel-subtraction">4. Determine pixel range and weight of blank channel subtraction.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#instructions">4.1 Instructions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-round">4.2 First Round</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#second-round">4.3 Second Round</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-subtraction">5. Gaussian Subtraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-sigma">5.1 Determine Sigma</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-pixel-range">5.2 Determine Pixel Range</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-weight">5.3 Determine Weight</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-subtraction">5.4 Perform Subtraction</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#view-results">6. View Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#post-processing">6. Post Processing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-image-and-parameters">7. Save Image and Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#auxiliary-functions">7. Auxiliary Functions</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="part-3-isolate-signal-from-autofluorescence-and-noise">
<h1>Part 3: Isolate signal from autofluorescence and noise.<a class="headerlink" href="#part-3-isolate-signal-from-autofluorescence-and-noise" title="Link to this heading">#</a></h1>
<p>In the following notebook you will use the blank channels to isolate signal.</p>
<section id="import-packages">
<h2>1. Import packages.<a class="headerlink" href="#import-packages" title="Link to this heading">#</a></h2>
<section id="this-must-be-done-every-time-the-notebook-is-started-or-restarted">
<h3>*This must be done every time the notebook is started or restarted.<a class="headerlink" href="#this-must-be-done-every-time-the-notebook-is-started-or-restarted" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skimage.io</span> <span class="kn">import</span> <span class="n">imread</span><span class="p">,</span> <span class="n">imsave</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">Kview</span>
<span class="kn">import</span> <span class="nn">stackview</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">filters</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">measure</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">exposure</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">import</span> <span class="nn">tifffile</span>
<span class="n">current_dateTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">imagej</span><span class="o">,</span> <span class="nn">scyjava</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ini_params</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">im2</span><span class="p">,</span> <span class="n">Pixel_Cutoff</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Blank_Percentile</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>

    <span class="n">im2_clip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">Pixel_Cutoff</span><span class="p">,</span> <span class="mi">65535</span><span class="p">)</span>
    <span class="n">im2_clip</span><span class="p">[</span><span class="n">im2_clip</span> <span class="o">&lt;=</span> <span class="n">Pixel_Cutoff</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">im3</span> <span class="o">=</span> <span class="n">im1</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">im2_clip</span> <span class="o">*</span> <span class="n">Blank_Percentile</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">im3</span>

<span class="k">def</span> <span class="nf">find_gauss</span><span class="p">(</span><span class="n">im_g1</span><span class="p">,</span> <span class="n">sigma_value</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>

    <span class="n">im_g2</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">im_g1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_value</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">im_g2</span>

<span class="k">def</span> <span class="nf">clipped_blank</span><span class="p">(</span><span class="n">im_cl1</span><span class="p">,</span> <span class="n">Gauss_low</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Gauss_high</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">):</span>

    <span class="n">im_cl1</span><span class="p">[</span><span class="n">Gauss_low</span> <span class="o">&gt;=</span> <span class="n">im_cl1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  
    <span class="n">im_cl1</span><span class="p">[</span><span class="n">im_cl1</span> <span class="o">&gt;=</span> <span class="n">Gauss_high</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">im_cl1</span>

<span class="k">def</span> <span class="nf">final_factor</span><span class="p">(</span><span class="n">im_f1</span><span class="p">,</span> <span class="n">im_f2</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">Gauss_Percentile</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>

    <span class="n">im_f2</span><span class="p">[</span><span class="n">low</span> <span class="o">&gt;=</span> <span class="n">im_f2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  
    <span class="n">im_f2</span><span class="p">[</span><span class="n">im_f2</span> <span class="o">&gt;=</span> <span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">im_f3</span> <span class="o">=</span> <span class="n">im_f1</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">im_f1</span><span class="p">,</span> <span class="n">im_f2</span> <span class="o">*</span> <span class="n">Gauss_Percentile</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">im_f3</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="define-directory-paths">
<h2>2. Define directory paths.<a class="headerlink" href="#define-directory-paths" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>*This must be done every time the notebook is started or restarted.<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_dir</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">smith6jt&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;KINTSUGI&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;1904_CC2B_Registration&#39;</span><span class="p">)</span>
<span class="n">sig_dir</span> <span class="o">=</span> <span class="n">reg_dir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_Registration&#39;</span><span class="p">,</span> <span class="s1">&#39;_Signal_Isolation&#39;</span><span class="p">)</span>
<span class="n">proc_dir</span> <span class="o">=</span> <span class="n">sig_dir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_Signal_Isolation&#39;</span><span class="p">,</span> <span class="s1">&#39;_Processed&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Registration folder is </span><span class="si">{</span><span class="n">reg_dir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signal_Isolation folder is </span><span class="si">{</span><span class="n">sig_dir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed folder is </span><span class="si">{</span><span class="n">proc_dir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registration folder is C:\Users\smith6jt\KINTSUGI\data\1904_CC2B_Registration.
Signal_Isolation folder is C:\Users\smith6jt\KINTSUGI\data\1904_CC2B_Signal_Isolation.
Processed folder is C:\Users\smith6jt\KINTSUGI\data\1904_CC2B_Processed.
</pre></div>
</div>
</div>
</div>
</section>
<section id="this-cell-only-needs-to-be-run-once">
<h3>2.1 This cell only needs to be run once.<a class="headerlink" href="#this-cell-only-needs-to-be-run-once" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">sig_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">proc_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proc_dir</span><span class="p">,</span><span class="s1">&#39;Processing_parameters&#39;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proc_dir</span><span class="p">,</span><span class="s1">&#39;PostProcessing&#39;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="write-single-channel-tifs">
<h2>3. Write single channel tifs<a class="headerlink" href="#write-single-channel-tifs" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ome_tiff_path</span> <span class="o">=</span> <span class="n">reg_dir</span> <span class="o">+</span> <span class="s2">&quot;merged.ome.tif&quot;</span>
<span class="n">ome_tiff</span> <span class="o">=</span> <span class="n">tifffile</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">ome_tiff_path</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tifffile</span><span class="o">.</span><span class="n">TiffFile</span><span class="p">(</span><span class="n">ome_tiff_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">tif</span><span class="p">:</span>

    <span class="n">xml_description</span> <span class="o">=</span> <span class="n">tif</span><span class="o">.</span><span class="n">ome_metadata</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml_description</span><span class="p">)</span>
<span class="n">namespace</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ome&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.openmicroscopy.org/Schemas/OME/2016-06&#39;</span><span class="p">}</span>

<span class="n">channel_metadata</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">channel_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.//ome:Channel&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
    <span class="n">channel_name</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">channel</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;Name&#39;</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">channel_metadata</span><span class="p">[</span><span class="n">channel_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span>
    <span class="n">channel_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>


<span class="k">for</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">channel_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

    <span class="n">channel_index</span> <span class="o">=</span> <span class="n">channel_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
    <span class="n">channel_data</span> <span class="o">=</span> <span class="n">ome_tiff</span><span class="p">[</span><span class="n">channel_index</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">channel_image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sig_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s1">.tif&#39;</span><span class="p">)</span>
    <span class="n">imsave</span><span class="p">(</span><span class="n">channel_image_path</span><span class="p">,</span> <span class="n">channel_data</span><span class="p">,</span> <span class="n">plugin</span><span class="o">=</span><span class="s1">&#39;tifffile&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">~\AppData\Local\Temp\ipykernel_19340\4071042450.py</span> in <span class="ni">?</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">ome_tiff_path</span> <span class="o">=</span> <span class="n">reg_dir</span> <span class="o">+</span> <span class="s2">&quot;merged.ome.tif&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">ome_tiff</span> <span class="o">=</span> <span class="n">tifffile</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">ome_tiff_path</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">with</span> <span class="n">tifffile</span><span class="o">.</span><span class="n">TiffFile</span><span class="p">(</span><span class="n">ome_tiff_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">tif</span><span class="p">:</span>

<span class="nn">~\miniforge3\envs\KINTSUGI\lib\site-packages\tifffile\tifffile.py</span> in <span class="ni">?</span><span class="nt">(files, selection, aszarr, key, series, level, squeeze, maxworkers, buffersize, mode, name, offset, size, pattern, axesorder, categories, imread, sort, container, chunkshape, dtype, axestiled, ioworkers, chunkmode, fillvalue, zattrs, multiscales, omexml, out, out_inplace, _multifile, _useframes, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1074</span> 
<span class="g g-Whitespace">   </span><span class="mi">1075</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1076</span>             <span class="n">files</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span>
<span class="g g-Whitespace">   </span><span class="mi">1077</span>         <span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1078</span>             <span class="k">with</span> <span class="n">TiffFile</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1079</span>                 <span class="n">files</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1080</span>                 <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1081</span>                 <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>

<span class="nn">~\miniforge3\envs\KINTSUGI\lib\site-packages\tifffile\tifffile.py</span> in <span class="ni">?</span><span class="nt">(self, file, mode, name, offset, size, omexml, _multifile, _useframes, _parent, **is_flags)</span>
<span class="g g-Whitespace">   </span><span class="mi">4072</span>                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid OME-XML&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">4073</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_omexml</span> <span class="o">=</span> <span class="n">omexml</span>
<span class="g g-Whitespace">   </span><span class="mi">4074</span>             <span class="bp">self</span><span class="o">.</span><span class="n">is_ome</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">   </span><span class="mi">4075</span> 
<span class="ne">-&gt; </span><span class="mi">4076</span>         <span class="n">fh</span> <span class="o">=</span> <span class="n">FileHandle</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">4077</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_fh</span> <span class="o">=</span> <span class="n">fh</span>
<span class="g g-Whitespace">   </span><span class="mi">4078</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_multifile</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">_multifile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_multifile</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">4079</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="p">{</span><span class="n">fh</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>

<span class="nn">~\miniforge3\envs\KINTSUGI\lib\site-packages\tifffile\tifffile.py</span> in <span class="ni">?</span><span class="nt">(self, file, mode, name, offset, size)</span>
<span class="g g-Whitespace">  </span><span class="mi">14258</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">offset</span>
<span class="g g-Whitespace">  </span><span class="mi">14259</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">size</span>
<span class="g g-Whitespace">  </span><span class="mi">14260</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_close</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">  </span><span class="mi">14261</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">NullContext</span><span class="p">()</span>
<span class="ne">&gt; </span><span class="mi">14262</span>         <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="g g-Whitespace">  </span><span class="mi">14263</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="nn">~\miniforge3\envs\KINTSUGI\lib\site-packages\tifffile\tifffile.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">  </span><span class="mi">14277</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="s1">&#39;r+b&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">,</span> <span class="s1">&#39;xb&#39;</span><span class="p">}:</span>
<span class="g g-Whitespace">  </span><span class="mi">14278</span>                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;invalid mode </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">  </span><span class="mi">14279</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
<span class="g g-Whitespace">  </span><span class="mi">14280</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
<span class="ne">&gt; </span><span class="mi">14281</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">  </span><span class="mi">14282</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span>
<span class="g g-Whitespace">  </span><span class="mi">14283</span>             <span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="g g-Whitespace">  </span><span class="mi">14284</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_close</span> <span class="o">=</span> <span class="kc">True</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;C:\\Users\\smith6jt\\KINTSUGI\\data\\1904_CC2B_Registrationmerged.ome.tif&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="determine-pixel-range-and-weight-of-blank-channel-subtraction">
<h2>4. Determine pixel range and weight of blank channel subtraction.<a class="headerlink" href="#determine-pixel-range-and-weight-of-blank-channel-subtraction" title="Link to this heading">#</a></h2>
<section id="instructions">
<h3>4.1 Instructions<a class="headerlink" href="#instructions" title="Link to this heading">#</a></h3>
<p>This cell allows the user to choose which blank channel to use (BlankID) and determine how much, if any, blank image to subtract(Blank_Percentile).  It also allows for only subtracting a range of pixel values (Pixel_Cutoff).  Use these values in the next cell.
For each marker, enter the name of the image file without the extension for signal_channel.</p>
<p>Change ‘bl_CH’ to a, b, or c according to the channel that marker was imaged on i.e. if marker is CH3, the last letter of both blanks should be ‘b’, CH4 should be ‘c’.  For far-red channels (700nm+), the blank channels often do not match the background autofluorescence well.  If this is the case, a suitable ‘b’ or ‘c’ blank should be chosen instead.</p>
<p>Change ‘bl_int’ to 1 or 13 according to the blank cycle.  Blank 13 generally has photobleached autofluorescent signal compared with Blank 1, and generally removes more diffuse background.  Sometimes the images from cycles earlier in the run will match closer to blank1 while those later will match closer to blank13.</p>
<p>Sometimes blurring before subtraction can help.  Uncomment to apply to either the blank or signal image.  Adjust sigma to control radius(strength) of blurring.</p>
<p>The first Kview.interact function is for viewing the effects of subtraction on a cropped portion of the image.  Adjust coordinates to determine the size.  The second is for viewing the whole image.</p>
<p>To assess subtraction, first slowly move the Blank_Percentile slider while noting if autofluorescent structures only are getting dimmer.  Continue until none of these remain while noting if marker signal is being diminished.  Then, slowly move the other slider until signal is brightest without reintroducing autofluorescence/noise.  Once values of Blank_Percentile and Pixel_Cutoff are found, use them for the next Kview.interact to see how they look on the entire image.</p>
<p>Note that these cells are meant to be rerun multiple times if necessary.</p>
</section>
<section id="first-round">
<h3>4.2 First Round<a class="headerlink" href="#first-round" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">signal_channel</span> <span class="o">=</span> <span class="s1">&#39;CD8&#39;</span>
<span class="n">bl_CH</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
<span class="n">bl_int</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">params_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proc_dir</span><span class="p">,</span> <span class="s1">&#39;Processing_parameters&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">signal_channel</span><span class="si">}</span><span class="s1">_param.txt&#39;</span><span class="p">)</span>
<span class="n">signal_image_tiff</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sig_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">signal_channel</span><span class="si">}</span><span class="s1">.tif&#39;</span><span class="p">))</span>
<span class="n">blankID</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Blank</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">bl_int</span><span class="p">)</span><span class="si">}{</span><span class="n">bl_CH</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">blank_image_tiff</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sig_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blankID</span><span class="si">}</span><span class="s1">.tif&#39;</span><span class="p">))</span>

<span class="n">blank_image_tiff</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">blank_image_tiff</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># signal_image_tiff = filters.gaussian(signal_image_tiff, sigma=1, preserve_range=True)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Working with: </span><span class="si">{</span><span class="n">signal_channel</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">blankID</span><span class="si">}</span><span class="s2">. Pixel min, max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">x2</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">y1</span> <span class="o">=</span> <span class="mi">4000</span>
<span class="n">y2</span> <span class="o">=</span> <span class="mi">6000</span>

<span class="c1"># Adjust zoom_factor to fit the image to your screen.  The other values can be adjusted as needed.</span>
<span class="n">Kview</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">ini_params</span><span class="p">,</span> <span class="n">signal_image_tiff</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">],</span> <span class="n">blank_image_tiff</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">],</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">65535</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Kview.interact(ini_params, signal_image_tiff, blank_image_tiff, zoom_factor=0.1, colormap = &#39;viridis&#39;, min_value=0, max_value=50000, step=1000)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working with: CD8 and Blank1b. Pixel min, max: 0, 55025
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d1602a6a430a4d1a89cba5208e0aa442", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Working with: </span><span class="si">{</span><span class="n">signal_channel</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">blankID</span><span class="si">}</span><span class="s2">. Pixel min, max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">Kview</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">ini_params</span><span class="p">,</span> <span class="n">signal_image_tiff</span><span class="p">,</span> <span class="n">blank_image_tiff</span><span class="p">,</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This cell performs the subtraction with values determined above.
If no subtraction was necessary, enter 0 for both and then go to 6. to visualize and save.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enter Pixel_Cutoff from above:</span>
<span class="n">blank_clip_factor</span> <span class="o">=</span> <span class="mi">13000</span>

<span class="c1"># Enter Blank_Percentile from above:</span>
<span class="n">background_scale_factor</span> <span class="o">=</span> <span class="mf">0.8</span>

<span class="n">blank_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">blank_image_tiff</span><span class="p">,</span> <span class="n">blank_clip_factor</span><span class="p">,</span> <span class="n">blank_image_tiff</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">blank_image</span><span class="p">[</span><span class="n">blank_image</span> <span class="o">&lt;=</span> <span class="n">blank_clip_factor</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">signal_image</span> <span class="o">=</span> <span class="n">signal_image_tiff</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">,</span> <span class="n">blank_image</span> <span class="o">*</span> <span class="n">background_scale_factor</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="second-round">
<h3>4.3 Second Round<a class="headerlink" href="#second-round" title="Link to this heading">#</a></h3>
<p>If desired the process can be repeated with the same or another blank channel to get satisfactory results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bl_CH2</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
<span class="n">bl_int2</span> <span class="o">=</span> <span class="mi">13</span>

<span class="n">blankID2</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Blank</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">bl_int</span><span class="p">)</span><span class="si">}{</span><span class="n">bl_CH</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">blank_image_tiff_2</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sig_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blankID2</span><span class="si">}</span><span class="s1">.tif&#39;</span><span class="p">))</span>
<span class="n">blank_image_tiff_2</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">blank_image_tiff_2</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Working with: </span><span class="si">{</span><span class="n">signal_channel</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">blankID2</span><span class="si">}</span><span class="s2">. Pixel min, max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">x2</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">y1</span> <span class="o">=</span> <span class="mi">4000</span>
<span class="n">y2</span> <span class="o">=</span> <span class="mi">7000</span>

<span class="n">Kview</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">ini_params</span><span class="p">,</span> <span class="n">signal_image</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">],</span> <span class="n">blank_image_tiff_2</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">],</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working with: CD8 and Blank1b. Pixel min, max: 0, 55025
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "93bd6908f5254315ad7312e621adcc2d", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Working with: </span><span class="si">{</span><span class="n">signal_channel</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">blankID2</span><span class="si">}</span><span class="s2">. Pixel min, max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">Kview</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">ini_params</span><span class="p">,</span> <span class="n">signal_image</span><span class="p">,</span> <span class="n">blank_image_tiff_2</span><span class="p">,</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">blank_clip_factor_2</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">background_scale_factor_2</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">blank_image_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">blank_image_tiff_2</span><span class="p">,</span> <span class="n">blank_clip_factor_2</span><span class="p">,</span> <span class="n">blank_image_tiff_2</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">blank_image_2</span><span class="p">[</span><span class="n">blank_image_2</span> <span class="o">&lt;=</span> <span class="n">blank_clip_factor_2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">signal_image</span> <span class="o">=</span> <span class="n">signal_image</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">signal_image</span><span class="p">,</span> <span class="n">blank_image_2</span> <span class="o">*</span> <span class="n">background_scale_factor_2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="gaussian-subtraction">
<h2>5. Gaussian Subtraction<a class="headerlink" href="#gaussian-subtraction" title="Link to this heading">#</a></h2>
<section id="determine-sigma">
<h3>5.1 Determine Sigma<a class="headerlink" href="#determine-sigma" title="Link to this heading">#</a></h3>
<p>If no other changes need to be made, go to Section 6 and save.</p>
<p>If there are patterns such as those with right angles that don’t represent biological variation, this section derives the pattern pixels for subtraction by creating a blurred version of the image, determining which pixels to clip, and then determining the weight of subtraction.</p>
<p>This Kview.interact function helps to find the optimal sigma value for blurring.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Higher sigma_values take longer to process.</span>
<span class="n">Kview</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">find_gauss</span><span class="p">,</span> <span class="n">signal_image</span><span class="p">,</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Enter the sigma value to control the degree of blurring.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">signal_gauss</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">signal_image</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">signal_gauss</span> <span class="o">=</span> <span class="n">exposure</span><span class="o">.</span><span class="n">match_histograms</span><span class="p">(</span><span class="n">signal_gauss</span><span class="p">,</span> <span class="n">signal_image</span><span class="p">,</span> <span class="n">multichannel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="determine-pixel-range">
<h3>5.2 Determine Pixel Range<a class="headerlink" href="#determine-pixel-range" title="Link to this heading">#</a></h3>
<p>Apply a range of pixel values to the gaussian subtraction by clipping low and/or high pixels from the blurred signal image that will be subtracted from the original signal image.  Run after performing the gaussian blur in the cell above.</p>
<p>Raising the Gauss_low value will eliminate the dimmer pixel values from the blurred image, resulting in more of the dimmer signal being preserved in the final processed image.</p>
<p>Lowering the Gauss_high value will eliminate the brighter pixel values from the blurred image, resulting in more of the brighter signal being preserved in the final processed image.</p>
<p>Comment/uncomment the lines to view cropped and full views of the blurred image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kview.interact(clipped_blank, signal_gauss[x1:x2,y1:y2], zoom_factor=0.5, colormap = &#39;viridis&#39;, continuous_update=True, display_min = 0, display_max = np.max(signal_gauss), min_value=0, max_value=np.max(signal_gauss), step=100)</span>

<span class="n">Kview</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">clipped_blank</span><span class="p">,</span> <span class="n">signal_gauss</span><span class="p">,</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">display_min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">display_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">signal_gauss</span><span class="p">),</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">signal_gauss</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="determine-weight">
<h3>5.3 Determine Weight<a class="headerlink" href="#determine-weight" title="Link to this heading">#</a></h3>
<p>Determine how much subtraction to do, similar to Blank_Percentile in Section 4.  Enter the Gauss_Cutoff values from the cell above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Gauss_low</span> <span class="o">=</span> <span class="mi">10800</span>
<span class="n">Gauss_high</span> <span class="o">=</span> <span class="mi">44789</span>

<span class="n">Kview</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">final_factor</span><span class="p">,</span> <span class="n">signal_image</span><span class="p">,</span> <span class="n">signal_gauss</span><span class="p">,</span> <span class="n">Gauss_low</span><span class="p">,</span> <span class="n">Gauss_high</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">display_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">signal_gauss</span><span class="p">),</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">0.07</span><span class="p">)</span>

<span class="c1"># Kview.interact(final_factor, signal_image[x1:x2,y1:y2], signal_gauss[x1:x2,y1:y2], Gauss_low, Gauss_high, colormap = &#39;viridis&#39;, display_max = np.max(signal_gauss), zoom_factor=.07)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d50e91923ac74151ae50ec46e2d21678", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="perform-subtraction">
<h3>5.4 Perform Subtraction<a class="headerlink" href="#perform-subtraction" title="Link to this heading">#</a></h3>
<p>Performs the gaussian subtraction.  Enter the value determined from the previous cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g_low</span> <span class="o">=</span> <span class="n">Gauss_low</span>
<span class="n">g_high</span> <span class="o">=</span> <span class="n">Gauss_high</span>
<span class="n">gauss_weight</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="n">signal_gauss</span><span class="p">[</span><span class="n">g_low</span> <span class="o">&gt;=</span> <span class="n">signal_gauss</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  
<span class="n">signal_gauss</span><span class="p">[</span><span class="n">signal_gauss</span> <span class="o">&gt;=</span> <span class="n">g_high</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">signal_image_final</span> <span class="o">=</span> <span class="n">signal_image</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">signal_image</span><span class="p">,</span> <span class="n">signal_gauss</span> <span class="o">*</span> <span class="n">gauss_weight</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="view-results">
<h2>6. View Results<a class="headerlink" href="#view-results" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that if no changes were made after initial subtraction, you must change signal_image_final to signal_image.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">signal_image_final</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">.65</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x1</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">x2</span> <span class="o">=</span> <span class="mi">3500</span>
<span class="n">y1</span> <span class="o">=</span> <span class="mi">4000</span>
<span class="n">y2</span> <span class="o">=</span> <span class="mi">4500</span>
<span class="n">stackview</span><span class="o">.</span><span class="n">curtain</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">[</span><span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">],</span> <span class="n">signal_image_final</span><span class="p">[</span><span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="n">curtain_colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stackview</span><span class="o">.</span><span class="n">animate_curtain</span><span class="p">(</span><span class="n">signal_image_tiff</span><span class="p">[</span><span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">],</span> <span class="n">signal_image_final</span><span class="p">[</span><span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">],</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="n">curtain_colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;KINTSUGI&#39;</span><span class="p">,</span> <span class="s1">&#39;docs&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">signal_channel</span><span class="si">}</span><span class="s1">_curtain.gif&#39;</span><span class="p">),</span> <span class="n">frame_delay_ms</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">num_loops</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="post-processing">
<h2>6. Post Processing<a class="headerlink" href="#post-processing" title="Link to this heading">#</a></h2>
<p>Move your mouse around the output of the following cell to assess background levels.  Areas with no signal should be zero.  Find the highest background values to subtract from the entire image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stackview</span><span class="o">.</span><span class="n">picker</span><span class="p">(</span><span class="n">signal_image_final</span><span class="p">[</span><span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">],</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">napari</span>

<span class="n">viewer</span> <span class="o">=</span> <span class="n">napari</span><span class="o">.</span><span class="n">Viewer</span><span class="p">()</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">add_image</span><span class="p">(</span><span class="n">signal_image_final</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;signal_image_final&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Assistant skips harvesting pyclesperanto as it&#39;s not installed.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Image layer &#39;signal_image_final&#39; at 0x1c5b9b5b940&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="save-image-and-parameters">
<h2>7. Save Image and Parameters<a class="headerlink" href="#save-image-and-parameters" title="Link to this heading">#</a></h2>
<p>Even with this process, it may be that certain markers should be excluded.  Manually create a “failed markers” file to list these and save it in the ‘Processing_parameters’ folder.</p>
<p>This cell saves the image and the parameters used.  The next steps in FIJI should be saved using Plugins&gt;Macros&gt;Record to record all steps. Copy/paste to append to the params file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Notes</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Here you can add any notes you want to save with the processing parameters.</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">variables</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>
<span class="n">variable_names_to_save</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;current_dateTime&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;signal_channel&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;blankID&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;blank_clip_factor&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;background_scale_factor&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;blankID2&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;blank_clip_factor_2&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;background_scale_factor_2&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;sigma&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;g_low&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;g_high&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;s_image_factor&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;blank_factor&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;Notes&#39;</span><span class="p">]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">params_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">variable_names_to_save</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">var_value</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
            <span class="n">var_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">var_value</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">var_str</span><span class="p">)</span>

<span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proc_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">signal_channel</span><span class="si">}</span><span class="s1">.tif&#39;</span><span class="p">),</span> <span class="n">signal_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="auxiliary-functions">
<h2>7. Auxiliary Functions<a class="headerlink" href="#auxiliary-functions" title="Link to this heading">#</a></h2>
<p>Merge all the images together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_id</span> <span class="o">=</span> <span class="s1">&#39;1904_CC2B&#39;</span>
<span class="n">pixelsize</span> <span class="o">=</span> <span class="mf">0.3774</span>
<span class="n">channel_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_list</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proc_dir</span><span class="p">,</span><span class="s1">&#39;*.tif&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">channel_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">channel_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proc_dir</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">sample_id</span><span class="si">}</span><span class="s1">.tif&#39;</span><span class="p">),</span> <span class="n">image</span><span class="p">,</span> <span class="n">imagej</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">pixelsize</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">pixelsize</span><span class="p">),</span> <span class="n">resolutionunit</span><span class="o">=</span><span class="s1">&#39;micron&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;axes&#39;</span><span class="p">:</span> <span class="s1">&#39;CYX&#39;</span><span class="p">,</span> <span class="s1">&#39;Labels&#39;</span><span class="p">:</span> <span class="n">channel_names</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>This function may be used in place of ini_params above to assess how subtraction affects signal to noise.  Must have a binary segmentation file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ini_params_SNR</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">imageb</span><span class="p">,</span> <span class="n">seg_mask</span><span class="p">,</span> <span class="n">blclfa</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bckscfa</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">.0</span><span class="p">):</span>

    <span class="n">blank_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">imageb</span><span class="p">,</span> <span class="n">blclfa</span><span class="p">,</span> <span class="mi">65535</span><span class="p">)</span>
    <span class="n">blank_image</span><span class="p">[</span><span class="n">blank_image</span> <span class="o">&lt;=</span> <span class="n">blclfa</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">signal_image</span> <span class="o">=</span> <span class="n">images</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">blank_image</span> <span class="o">*</span> <span class="n">bckscfa</span><span class="p">))</span>
    <span class="n">seg_mask</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">seg_mask</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span><span class="n">seg_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">intensity_image</span><span class="o">=</span><span class="n">signal_image</span><span class="p">)</span>
    <span class="n">statistics</span> <span class="o">=</span> <span class="p">{</span>
   
    <span class="s1">&#39;area&#39;</span><span class="p">:</span>       <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">area</span>               <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">area</span><span class="o">&lt;</span><span class="mi">800</span><span class="p">],</span>
    <span class="s1">&#39;mean&#39;</span><span class="p">:</span>       <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">mean_intensity</span>     <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">area</span><span class="o">&lt;</span><span class="mi">800</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">statistics</span><span class="p">)</span>
    
    <span class="n">MFI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">])</span>
    <span class="n">aX</span> <span class="o">=</span> <span class="n">MFI</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="c1"># compute 20 largest values in aX</span>
    <span class="n">top20</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">aX</span><span class="p">)[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span>
    <span class="c1"># compute the mean of bottom 10th percentile of aX</span>
    <span class="n">btm10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">aX</span><span class="p">)[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aX</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">top20btm10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">top20</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">btm10</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SNR is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top20btm10</span><span class="p">))</span> 
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">signal_image</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Kview</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">ini_params_SNR</span><span class="p">,</span> <span class="n">signal_image</span><span class="p">,</span> <span class="n">blank_image_tiff_2</span><span class="p">,</span> <span class="n">zoom_factor</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./src\notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="2_Cycle_Processing.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Part 2: Batch Process</p>
      </div>
    </a>
    <a class="right-next"
       href="4_Segmentation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Part 4: Segment cells and nuclei.</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">1. Import packages.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#this-must-be-done-every-time-the-notebook-is-started-or-restarted">*This must be done every time the notebook is started or restarted.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-directory-paths">2. Define directory paths.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">*This must be done every time the notebook is started or restarted.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#this-cell-only-needs-to-be-run-once">2.1 This cell only needs to be run once.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#write-single-channel-tifs">3. Write single channel tifs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-pixel-range-and-weight-of-blank-channel-subtraction">4. Determine pixel range and weight of blank channel subtraction.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#instructions">4.1 Instructions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-round">4.2 First Round</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#second-round">4.3 Second Round</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-subtraction">5. Gaussian Subtraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-sigma">5.1 Determine Sigma</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-pixel-range">5.2 Determine Pixel Range</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-weight">5.3 Determine Weight</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-subtraction">5.4 Perform Subtraction</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#view-results">6. View Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#post-processing">6. Post Processing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-image-and-parameters">7. Save Image and Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#auxiliary-functions">7. Auxiliary Functions</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Justin Smith
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>